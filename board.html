<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang="en">
<head>
<title>Chess</title>
<style>
img 
{ 
 border: none;
 margin: 0px;
}

table.board
{
 border: 2px solid black;
 border-collapse: collapse; 	/* cellspacing=0 cellpadding=0 */
}

td.square
{
 border-style: none;
 padding: 0em;
 margin: 0em;
 width: 53px;
 height: 53px;
}

/* Colors based on http://en.wikipedia.org/wiki/Chessboard
 * Useful site: http://www.cssdrive.com/imagepalette/index.php
 * Colors palette generator, get colors of an arbitrary image.
 *
 * Other colors to consider: http://chessos.com/, higher contrast
 *  http://chessteacher.110mb.com/, much lighter
 * But I like these, gives it a nice wooden feel. Could also
 * use green for a tournament-style board.
 */
td.white { background-color: #ffce9e; }
td.black { background-color: #d18b47; }

/* Would be cool to use CSS3 expressions to make the pattern, but they're not in
 * Firefox 3.0.8, maybe in Firefox 3.1. Safari has them though! 
 * If do this, would need to remember to shift nth-child per ranks. 
/*td:nth-child(2n) { background-color: green } */

</style>
<script src="http://www.google.com/jsapi"></script>
<script language="javascript">
google.load("prototype", "1.6.0.3");
google.load("scriptaculous", "1.8.2");

google.setOnLoadCallback(function() {
	/* TODO: for revert, instead of true, use a function
	 * that checks whether the move is valid */
	//new Draggable($("x"), { revert: true, starteffect: undefined } );

	//load_fen("rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR");
	load_fen("rnbqkbnr/pp1ppppp/8/2p5/4P3/5N2/PPPP1PPP/RNBQKB1R");
});

function load_fen(fen)
{
	var i, x, y, code;

	// Note that ranks and files internally are represented here by
	// x,y coordinates, so a8 = 0,0. That is where FEN starts.
	x = y = 0;
	for (i = 0; i < fen.length; ++i) {
		code = fen.charAt(i);
		if (/[a-zA-Z]/.test(code)) {
			sq(x, y).appendChild(new_piece(code));
			++x;
		} else if (code == "/") {
			x = 0;
			++y;
		} else if (/[0-9]/.test(code)) {
			x += code.charCodeAt(0) - "0".charCodeAt(0);
		}
	}
}

// Create a new piece or pawn, given the name in
// Forsyth-Edwards Notation, for example:
//  r = black rook, R = white rook, N = white knight
function new_piece(name)
{
	var color;
	var filename;

	// In FEN, uppercase=white, lower=black
	if (/^[RNBQKP]/.test(name)) {
		color = "w";
	} else if (/^[rnbqkp]/.test(name)) {
		color = "b";
	} else {
		assert("new_piece(" + name + "): unrecognized");
	}

	filename = 'images/' + color + name.toLowerCase() + '.gif';

	return Builder.node('img', {'src': filename});
}

// Get a square cell, given location in either
// - algebraic notation (example: "a8", one argument), or
// - x,y coordinates, (equivalent example: 0,0)
function sq(code, extra)
{
	var rank, file;

	if (extra !== undefined) {
		file = code;
		rank = extra;
	} else {
		file = code.charCodeAt(0) - "a".charCodeAt(0);
		rank = 8 - (code.charCodeAt(1) - "0".charCodeAt(0));
	}

	assert(rank >= 0 && rank <= 7, "sq(" + code + ", " + extra + "): bad rank: " + rank);
	assert(file >= 0 && file <= 7, "sq(" + code + ", " + extra + "): bad file: " + file);

	return $('board-body').childNodes[rank].childNodes[file];
}

// Based on http://aymanh.com/9-javascript-tips-you-may-not-know
function AssertException(message) { this.message = message; }
AssertException.prototype.toString = function() {
	return 'AssertException: ' + this.message;
};

function assert(expression, message)
{
	if (!expression) 
		throw new AssertException(message);
}


</script>
</head>

<body>

<table id="outer">
 <tr>
  <td></td>
  <td>a</td>
  <td>b</td>
  <td>c</td>
  <td>d</td>
  <td>e</td>
  <td>f</td>
  <td>g</td>
  <td>h</td>
 </tr><tr>
  <td></td>
  <td colspan="8" rowspan="8"> 

<table class="board" id="board"
><tbody id="board-body"
><tr
  ><td class="white square"></td
  ><td class="black square"></td
  ><td class="white square"></td
  ><td class="black square"></td
  ><td class="white square"></td
  ><td class="black square"></td
  ><td class="white square"></td
  ><td class="black square"></td
></tr
><tr
 ><td id=y class="black square"></td
 ><td class="white square"></td
 ><td class="black square"></td
 ><td class="white square"></td
 ><td class="black square"></td
 ><td class="white square"></td
 ><td class="black square"></td
 ><td class="white square"></td
></tr
><tr
  ><td class="white square"></td
  ><td class="black square"></td
  ><td class="white square"></td
  ><td class="black square"></td
  ><td class="white square"></td
  ><td class="black square"></td
  ><td class="white square"></td
  ><td class="black square"></td
></tr
><tr
 ><td id=y class="black square"></td
 ><td class="white square"></td
 ><td class="black square"></td
 ><td class="white square"></td
 ><td class="black square"></td
 ><td class="white square"></td
 ><td class="black square"></td
 ><td class="white square"></td
></tr
><tr
  ><td class="white square"></td
  ><td class="black square"></td
  ><td class="white square"></td
  ><td class="black square"></td
  ><td class="white square"></td
  ><td class="black square"></td
  ><td class="white square"></td
  ><td class="black square"></td
></tr
><tr
 ><td id=y class="black square"></td
 ><td class="white square"></td
 ><td class="black square"></td
 ><td class="white square"></td
 ><td class="black square"></td
 ><td class="white square"></td
 ><td class="black square"></td
 ><td class="white square"></td
></tr
><tr
  ><td class="white square"></td
  ><td class="black square"></td
  ><td class="white square"></td
  ><td class="black square"></td
  ><td class="white square"></td
  ><td class="black square"></td
  ><td class="white square"></td
  ><td class="black square"></td
></tr
><tr
 ><td id=y class="black square"></td
 ><td class="white square"></td
 ><td class="black square"></td
 ><td class="white square"></td
 ><td class="black square"></td
 ><td class="white square"></td
 ><td class="black square"></td
 ><td class="white square"></td
></tr
></tbody
></table>

 </td>
</tr><tr><td height=53>8</td height=53>
</tr><tr><td height=53>7</td height=53>
</tr><tr><td height=53>6</td height=53>
</tr><tr><td height=53>5</td height=53>
</tr><tr><td height=53>4</td height=53>
</tr><tr><td height=53>3</td height=53>
</tr><tr><td height=53>2</td height=53>
</tr><tr><td height=53>1</td height=53>
</tr>
</table>
</body>
</html>
